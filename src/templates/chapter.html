<!DOCTYPE html>
<html>
<head>
    <title>{{ chapter.title }} of {{ book.name }} Read Online Free - {{ sitename }}</title>
    {% include 'common/head_meta.html' %}
</head>
<body class="{% if user_settings.darkMode == 'dark' %}bg-dark text-light{% endif %}" style="font-size: {{ user_settings.fontSize }};">

{% include 'common/navbar.html' %}

<main>
    <section class="text-center mt-5">
        <a href="{{ url_for('book.get_book', book_slug=book.slug) }}" class="text-muted">
            {{ book.name }}
        </a>
    </section>

    <article class="container box mt-2 mb-4 article-content" id="article-content">
        {{ content|safe }}
    </article>

    <section class="container mt-4 mb-5 d-flex justify-content-center box">
        {% if prev_chapter_url %}
            <a href="{{ prev_chapter_url }}" class="me-3">Prev</a>
        {% endif %}

        <span class="d-block mx-3"></span>

        {% if next_chapter_url %}
            <a href="{{ next_chapter_url }}">Next</a>
        {% endif %}
    </section>
</main>

{% include 'common/footer.html' %}
<script>
    // Track scroll position and save progress when the user scrolls or leaves the page
    window.addEventListener('scroll', () => {
        saveReadingProgress(bookSlug, chapterNo, getFirstVisibleSentenceId());
    });

    document.addEventListener('DOMContentLoaded', function () {
        initWordTranslation();
        initSentenceTranslation();
    });
</script>
</body>
</html>
